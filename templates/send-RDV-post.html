<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Formulaire Rappel RDV</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/water.css@2/out/water.css">
</head>
<body>

    <h2>Formulaire de Rappel de Rendez-vous</h2>

    <form id="rdvForm" action="/rappel" method="POST">
        <!-- Num√©ro de t√©l√©phone -->
        <label for="num">Num√©ro :</label>
        <input type="text" id="num" name="num" required pattern="^[0-9]{10}$" title="Le num√©ro doit contenir exactement 10 chiffres">
        <br>

        <!-- Message -->
        <label for="msg">Message :</label>
        <input type="text" id="msg" name="msg" required>
        <br>

        <!-- Date du rendez-vous -->
        <label for="date_rdv">Date du Rendez-vous :</label>
        <input type="date" id="date_rdv" name="date_rdv" required>
        <br>

        <!-- Heure du rendez-vous -->
        <label for="heure_rdv">Heure du Rendez-vous :</label>
        <input type="time" id="heure_rdv" name="heure_rdv" required>
        <br>

        <!-- Choix du template de message -->
        <label for="msg_template">Mod√®le de message :</label>
        <select id="msg_template" name="msg_template">
            <option value="naissance" selected>Rappel RDV Naissance</option>
            <option value="mariage">Rappel RDV Mariage</option>
            <option value="general">Rappel RDV G√©n√©ral</option>
        </select>
        <br>


    <!-- Aper√ßu dynamique du message -->
    <h3>Pr√©visualisation du message :</h3>
    <p id="message_preview"></p>

        <!-- Bouton d'envoi -->
        <button type="submit">Envoyer le Rappel</button>
    </form>


<script>

    // D√©finition des templates de message
        const templates = {
            "naissance": "üì¢ Rappel : Rendez-vous pour une consultation naissance le {date} √† {heure}.",
            "mariage": "üíç Rappel : Votre rendez-vous pour les pr√©paratifs de mariage est pr√©vu le {date} √† {heure}.",
            "general": "üìÖ Rappel : Votre rendez-vous ({type}) est pr√©vu le {date} √† {heure}."
        };

        function updatePreview() {
            let selectedTemplate = document.getElementById("msg_template").value;
            let typeRdv = document.getElementById("type_rdv").value || "votre rendez-vous";
            let dateRdv = document.getElementById("date_rdv").value || "JJ/MM/AAAA";
            let heureRdv = document.getElementById("heure_rdv").value || "HH:MM";

            let previewMessage = templates[selectedTemplate]
                .replace("{date}", dateRdv)
                .replace("{heure}", heureRdv)
                .replace("{type}", typeRdv);

            document.getElementById("message_preview").innerText = previewMessage;
        }

        // Mettre √† jour la preview lors des changements
        document.getElementById("msg_template").addEventListener("change", updatePreview);
        document.getElementById("type_rdv").addEventListener("input", updatePreview);
        document.getElementById("date_rdv").addEventListener("input", updatePreview);
        document.getElementById("heure_rdv").addEventListener("input", updatePreview);

        // Initialisation
        updatePreview();

        document.getElementById("rdvForm").addEventListener("submit", function(event) {
            let num = document.getElementById("num").value;
            let msg = document.getElementById("msg").value;
            let date_rdv = document.getElementById("date_rdv").value;
            let heure_rdv = document.getElementById("heure_rdv").value;
            let type_rdv = document.getElementById("type_rdv").value;

            // V√©rification du num√©ro (exactement 10 chiffres)
            let numPattern = /^[0-9]{10}$/;
            if (!numPattern.test(num)) {
                alert("Le num√©ro doit contenir exactement 10 chiffres.");
                event.preventDefault();
                return;
            }

            // V√©rification des caract√®res sp√©ciaux interdits dans le message
            let msgPattern = /^[a-zA-Z0-9\s.,!?√†√ß√©√®√™'-]+$/;
            if (!msgPattern.test(msg)) {
                alert("Le message contient des caract√®res interdits. Utilisez uniquement des lettres, chiffres et les symboles .,!?'-");
                event.preventDefault();
                return;
            }

            // V√©rification de la date du rendez-vous (doit √™tre une date valide et future)
            let today = new Date().toISOString().split("T")[0];
            if (date_rdv < today) {
                alert("La date du rendez-vous doit √™tre dans le futur.");
                event.preventDefault();
                return;
            }

            // V√©rification de l'heure du rendez-vous
            if (!heure_rdv) {
                alert("Veuillez entrer une heure de rendez-vous valide.");
                event.preventDefault();
                return;
            }

            // V√©rification du type de rendez-vous (doit √™tre renseign√©)
            if (type_rdv.trim() === "") {
                alert("Veuillez pr√©ciser le type de rendez-vous.");
                event.preventDefault();
                return;
            }
        });
    </script>

</body>
</html>
